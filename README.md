# Front-end-intelligence

## è¿­ä»£1 ç€‘å¸ƒæµå¸ƒå±€

## è¿­ä»£2 æ°´å°

### ç»“æœå±•ç¤º

#### åŠ¨æ€æ°´å°

ä½¿ç”¨svgæ–¹æ¡ˆåŠ¨æ€ç”Ÿæˆï¼š

![img](https://docimg4.docs.qq.com/image/AgAABnOijIm7uCeshNBAu63uLe0gLxd1.png?w=1252&h=932)

![img](https://docimg3.docs.qq.com/image/AgAABnOijIm3rEEYKa5D96BMG9tFIq4E.png?w=623&h=936)

#### é¢‘åŸŸæ°´å°

åŸºäºå‚…ç«‹å¶å˜æ¢çš„æ–¹æ¡ˆï¼Œåˆ©ç”¨å‚è€ƒæ–‡çŒ®4ç”Ÿæˆã€‚

åŸå§‹å›¾ç‰‡ï¼š

![img](https://docimg7.docs.qq.com/image/AgAABnOijIlkInqXrglEu6XTFEj7-oP5.jpeg?w=4272&h=2848)

è®¾ç½®æ°´å°â€œåˆ˜ç¥éª201250215â€ï¼Œéšå†™æœ¯ä¸ºçº§åˆ«2ï¼Œå¯†ç 654321ç”Ÿæˆçš„å›¾åƒï¼š

![img](https://docimg5.docs.qq.com/image/AgAABnOijIl9HKBzUdhL9aBIZHpPu4uF.png?w=500&h=333)

è§£ç éªŒè¯ï¼š![img](https://docimg7.docs.qq.com/image/AgAABnOijImokZonQbhMWbds1cw5J3IJ.png?w=657&h=779)

### ä½¿ç”¨æ–¹å¼

1. ç‚¹å‡»waterfall.htmlï¼Œæˆ–è€…ç‚¹å‡»å…¶ä»–htmlï¼Œå†ç‚¹å‡»tabæ ä¸­çš„æ°´å°è¿›å…¥æœ¬é¡µé¢ã€‚

![img](https://docimg5.docs.qq.com/image/AgAABnOijIlEBSCV55lPRbdZRAJr83QR.png?w=2282&h=1207)

2. åŠ¨æ€æ°´å°çš„ç”Ÿæˆéœ€è¦ç”¨\<div class="picture"\>çš„ç›’å­åŒ…è£¹åŸå›¾ï¼ˆImgï¼‰ï¼Œæ‰€ä»¥ä¿®æ”¹æºä»£ç å³å¯ã€‚waterfall.jsä¼šä¸ºæ¯ä¸ªclassä¸ºpictureçš„divå…ƒç´ è°ƒç”¨__svgWMï¼Œå®ç°åŠ¨æ€æ°´å°ç”Ÿæˆã€‚

   **æ³¨æ„ï¼**è‹¥æ°´å°æœªè¦†ç›–å…¨å›¾ï¼Œåªåœ¨å›¾ç‰‡æœ€ä¸Šæ–¹æœ‰ä¸€ç‚¹ï¼Œæ˜¯å› ä¸ºæµè§ˆå™¨ç¼“å­˜å½±å“äº†divå…ƒç´ é«˜åº¦çš„å®æ—¶è·å–ï¼Œå»ºè®®ä½¿ç”¨VSCodeçš„Live Serverè¿è¡Œã€‚

   ```html
   <div class="picture">
      <img src="å¸Œæœ›ç”Ÿæˆæ°´å°çš„åŸå§‹å›¾ç‰‡è·¯å¾„">
   </div>
   ```

3. é¢‘åŸŸæ°´å°çš„ç”Ÿæˆå¯ä»¥åœ¨2.2åœ¨çº¿æ“ä½œå®Œæˆã€‚å®ƒè¦†ç›–LSBæ°´å°å’Œé¢‘åŸŸæ°´å°ä¸¤ç±»ç›²æ°´å°ï¼Œå…¶ä¸­DCTæ¨¡å¼æ˜¯ç¦»æ•£ä½™å¼¦å˜æ¢ï¼Œä¸ºåªä½¿ç”¨å®æ•°çš„ç¦»æ•£å‚…é‡Œå¶å˜æ¢ã€‚

   1. å°†å¯†æ–‡å†™å…¥å›¾ç‰‡ï¼š![img](https://docimg6.docs.qq.com/image/AgAABnOijIlGMpi_TyJNZIsY29TIPS0N.png?w=647&h=999)
   2. ä»å›¾ç‰‡ä¸­è¯»å–å¯†æ–‡ï¼š![img](https://docimg7.docs.qq.com/image/AgAABnOijImokZonQbhMWbds1cw5J3IJ.png?w=657&h=779)

### æ–‡ä»¶ç›®å½•

ä½œä¸šä¸‰åœ¨ä½œä¸šäºŒçš„åŸºç¡€ä¸Šå®Œæˆï¼Œè¿™é‡Œä»…åˆ—ä¸¾æ–°å¢çš„æ–‡ä»¶ï¼š

1. watermark.htmlï¼šæ°´å°é¡µé¢ï¼Œæ”¯æŒåŠ¨æ€æ°´å°å’Œé¢‘åŸŸæ°´å°ã€‚
2. staticæ–‡ä»¶å¤¹ï¼š
   1. jsï¼š
      1. watermark.jsï¼šfunction __svgWM()å®ç°åŠ¨æ€æ°´å°ï¼ŒwriteIMG()å’ŒreadIMG()å®ç°é¢‘åŸŸæ°´å°ã€‚
      2. cryptostego.min.jsï¼šä¸ºé¢‘åŸŸæ°´å°çš„å®ç°æä¾›writeMsgToCanvasã€readMsgFromCanvasã€loadIMGtoCanvasæ¥å£ã€‚
   2. picsï¼šæ–°å¢blind_pic6.pngï¼Œç”¨äºå±•ç¤ºç›²æ°´å°æ•ˆæœã€‚

### å®ç°æ–¹æ³•ä¸å…³é”®ä»£ç 

#### åŠ¨æ€æ°´å°

1. å®šä¹‰__svgWMå‡½æ•°çš„é»˜è®¤å‚æ•°å’ŒsvgStrï¼Œä¸ºäº†æµè§ˆå™¨å…¼å®¹æ€§å°†SVGç¼–ç ä¸ºBase64ã€‚

   ```javascript
   function __svgWM({//é»˜è®¤å‚æ•°å®ç°æ°´å°æ ·å¼çš„åˆå§‹åŒ–
       container = document.body,
       content = 'è¯·å‹¿å¤–ä¼ ',
       width = '300px',
       height = '200px',
       fontSize = '20px',
       zIndex = 1000
   }
   ```

   ```javascript
   //ä¼ å…¥çš„å‚æ•°ä¼šä¿®æ”¹æ°´å°çš„æ ·å¼å’Œæ–‡æœ¬å†…å®¹
   const svgStr = `<svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}">
   	<text x="50%" y="50%" 
       text-anchor="middle"
       font-size="${fontSize}"
       transform='rotate(-45, 100 100)'
       font-family="system-ui, sans-serif"
       dominant-baseline="middle"
       fill="#1d1d1f" 
       fill-opacity="0.3"
    	>
       ${content}
       </text>
       </svg>`;
   // è€ƒè™‘åˆ°æµè§ˆå™¨å…¼å®¹æ€§ï¼Œç”¨ä½œèƒŒæ™¯å›¾ç‰‡æ—¶ï¼Œå»ºè®®å°† SVG ç¼–ç ä¸º Base64
   const base64Url = `data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(svgStr)))}`;
   ```

   ç¼–ç æˆbase64åsvgå­—ç¬¦ä¸²å°±å‡†å¤‡å¥½äº†ï¼Œç­‰å¾…ä¸‹ä¸€æ­¥ä½œä¸ºèƒŒæ™¯ã€‚

2. åˆ›å»ºdivå®¹å™¨watermarkDivï¼Œè®¾ç½®å±æ€§åæ’å…¥åˆ°åŒ…å›´åŸå›¾çš„divå®¹å™¨containerå‰ã€‚

   1. é€šè¿‡è®¾ç½®watermarkDivçš„positionä¸ºabsoluteï¼Œcontainerçš„positionä¸ºrelativeï¼ŒwatermarkDivçš„z-Indexå±æ€§â‰¥0ï¼Œå¯ä»¥è®©æ°´å°å›¾ç‰‡æ˜¾ç¤ºåœ¨ä¸Šå±‚ï¼ˆå­å…ƒç´ è¦†ç›–ï¼‰

   2. é€šè¿‡scrollWidthå’ŒscrollHeightè·å¾—containerçš„å®½å’Œé«˜ï¼Œå¯ä»¥è®¾ç½®watermarkDivçš„å¤§å°ï¼Œè®©æ°´å°æ­£å¥½è¦†ç›–container

   3. é€šè¿‡è®¾ç½®watermarkDivçš„background-imageä¸ºç¬¬ä¸€æ­¥å¾—åˆ°çš„svgçš„base64ç¼–ç å­—æ®µï¼Œå¹¶è®¾ç½®ä¸ºå¯é‡å¤èƒŒæ™¯ï¼ˆrepeatï¼‰ï¼Œå°±å¯ä»¥è®©æ°´å°å¡«æ»¡å®¹å™¨

      ```javascript
      const watermarkDiv = __wm || document.createElement("div");
      //è¿™é‡Œçš„widthå’Œheightè·å–äº†containerçš„å®½å’Œé«˜ï¼Œè®©æ°´å°å¯ä»¥è¦†ç›–container
      var w = `${container.scrollWidth}` + 'px'
      var h = `${container.scrollHeight}` + 'px'
      
      watermarkDiv.setAttribute('style', `
      	position:absolute;
          top:0;
          left:0;
          width:${w};
          height:${h};
          z-index:${zIndex};
          pointer-events:none;
          background-repeat:repeat;
          background-image:url('${base64Url}')`);
      
      container.style.position = 'relative';
      container.insertBefore(watermarkDiv, container.firstChild);
      ```

3. ä¸ºäº†åº”å¯¹äººä¸ºä¿®æ”¹çš„æ”»å‡»åœºæ™¯ï¼Œåˆ›å»ºMutationObserveræ¥ç›‘å¬DOMå˜åŠ¨ã€‚ä¸€æ—¦ç›‘å¬åˆ°DOMå…ƒç´ è¢«ä¿®æ”¹æˆ–åˆ é™¤ï¼Œå°±ç«‹å³é‡æ–°æ’å…¥ä¸€ä¸ªã€‚

   ```javascript
   const MutationObserver = window.MutationObserver || window.WebKitMutationObserver;
   	if (MutationObserver) {
   		let mo = new MutationObserver(function () {
           const __wm = document.querySelector('.__wm');
           // åªåœ¨__wmå…ƒç´ å˜åŠ¨æ‰é‡æ–°è°ƒç”¨ __svgWM
           if ((__wm && __wm.getAttribute('style') !== styleStr) || !__wm) {
           	// é¿å…ä¸€ç›´è§¦å‘
               mo.disconnect();
               mo = null;
               __svgWM(JSON.parse(JSON.stringify(args)));
           }
   	});
   
       mo.observe(container, {
       	attributes: true,
           subtree: true,
           childList: true
       })
   }
   ```

4. åŠ¨æ€æ°´å°çš„ç”Ÿæˆéœ€è¦ç”¨\<div class="picture"\>çš„ç›’å­åŒ…è£¹åŸå›¾ï¼ˆimgï¼‰ï¼Œæ‰€ä»¥é€šè¿‡å¾ªç¯éå†ç±»ä¸º'picture'çš„divå®¹å™¨åˆ—è¡¨ï¼ˆæ”¹å˜containerï¼‰ï¼Œè°ƒç”¨__svgWMå®ç°æ°´å°çš„åŠ¨æ€ç”Ÿæˆã€‚

   ```javascript
   //å¾ªç¯éå†æ¯ä¸ªè£…æœ‰éœ€è¦åŠ æ°´å°å›¾ç‰‡çš„å®¹å™¨ï¼Œè°ƒç”¨__svgWM
   var list = document.getElementsByClassName('picture')
   Array.prototype.forEach.call(list, function (el) {
   	__svgWM({
       	container: el,//æ¯ä¸ªè£…æœ‰å›¾ç‰‡çš„å®¹å™¨
           content: 'åˆ˜ç¥éª201250215',
       })
   });
   ```

   ```javascript
   <div class="picture">//htmlä¸­ä½¿ç”¨åŠ¨æ€æ°´å°çš„ç¤ºä¾‹
   	<img src="static/pics/pic4.jpg">
   </div>
   <div class="picture">
   	<img src="static/pics/pic17.jpg">
   </div>
   ```

#### é¢‘åŸŸæ°´å°

åˆ©ç”¨cryptostego.min.jsæä¾›çš„æ¥å£writeMsgToCanvaså’ŒreadMsgFromCanvasï¼Œç¼–å†™loadIMGtoCanvasçš„å›è°ƒå‡½æ•°writefuncå’Œreadfuncã€‚

è¿™æ ·å¯ä»¥ä¿è¯åœ¨è°ƒç”¨writeMsgToCanvaså’ŒreadMsgFromCanvasæ—¶å›¾ç‰‡å·²ç»è¢«è£…å…¥canvasã€‚

```javascript
function writefunc() {
	var selectedVal = '';
	var selected = $("input[type='radio'][name='mode']:checked");
    if (selected.length > 0) {
    	selectedVal = selected.val();
    }
    var t = writeMsgToCanvas('canvas', $("#msg").val(), $("#pass").val(), selectedVal);
    if (t === true) {
    	var myCanvas = document.getElementById("canvas");
        var image = myCanvas.toDataURL("image/png");
        $("#blindres").attr('src', image);
        $("#result").html('ç”ŸæˆæˆåŠŸ! èµ¶å¿«å³é”®ä¿å­˜åˆ°æœ¬åœ°å§ï¼');
        $("#blindres").show();
    } else $("#result").html(t);
}
loadIMGtoCanvas('blind', 'canvas', writefunc, 500);
```

```javascript
function readfunc() {
	var selectedVal = '';
	var selected = $("input[type='radio'][name='mode']:checked");
    if (selected.length > 0) {
    	selectedVal = selected.val();
    }
    var t = readMsgFromCanvas('canvas', $("#pass").val(), selectedVal);
    if (t != null) {
    	t = t.split('&').join('&amp;');
        t = t.split(' ').join('&nbsp;');
        t = t.split('<').join('&lt;');
        t = t.split('>').join('&gt;');
        t = t.replace(/(?:\r\n|\r|\n)/g, '<br />');
        $("#result").html(t);
    } else $("#result").html('ERROR REAVEALING MESSAGE!');
}
loadIMGtoCanvas('blind', 'canvas', readfunc);
```

## è¿­ä»£3 ä¸»é¢˜åˆ‡æ¢

### æ•ˆæœå±•ç¤º

#### äº®è‰²æ¨¡å¼

![img](https://docimg3.docs.qq.com/image/AgAABnOijIlz9jFQAFVB_6zyUjAARN5k.png?w=2060&h=1244)

![img](https://docimg10.docs.qq.com/image/AgAABnOijIku55a-aiBOvIui7RfVpNnQ.png?w=2059&h=714)

#### æš—è‰²æ¨¡å¼

![img](https://docimg6.docs.qq.com/image/AgAABnOijIlD_XzQWcpJx6n7D08qj9s6.png?w=2160&h=1262)

![img](https://docimg5.docs.qq.com/image/AgAABnOijImGTxNp9XxDfJD0GwdCS24P.png?w=1957&h=721)

### ä½¿ç”¨æ–¹å¼

ç‚¹å‡»index.htmlï¼Œç‚¹å‡»å·¦æŒ‰é’®ä¸ºäº®è‰²æ¨¡å¼ï¼Œç‚¹å‡»å³æŒ‰é’®ä¸ºæš—è‰²æ¨¡å¼ï¼ˆæ— éœ€è®°å¿†ï¼Œé¼ æ ‡æ‚¬æµ®ä¼šæœ‰æç¤ºï¼‰ã€‚é»˜è®¤ä¸ºäº®è‰²æ¨¡å¼ã€‚ï¼ˆå…¶ä»–htmlé¡µé¢ä¸æœ¬æ¬¡ä½œä¸šæ— å…³ï¼‰![img](https://docimg1.docs.qq.com/image/AgAABnOijIlo7n8Z6l1DSKt2oLIf0_tU.png?w=839&h=140)

### æ–¹æ¡ˆä¸å…³é”®ä»£ç 

é€‰æ‹©â€œæå‰å¼•å…¥æ‰€æœ‰ä¸»é¢˜æ ·å¼ï¼Œåšç±»ååˆ‡æ¢â€çš„æ–¹æ¡ˆï¼Œå³ä¸º[å‚è€ƒèµ„æ–™1](https://mp.weixin.qq.com/s/J90TYDJGmo8KCTsawT-vIg)çš„æ–¹æ¡ˆ2ã€‚å®ç°é€»è¾‘è¾ƒç®€å•ï¼Œåœ¨index.cssä¸­å®šä¹‰å¥½æ ·å¼ï¼Œå†ç”¨jså®ç°åˆ‡æ¢å³å¯ã€‚

```css
/* é»˜è®¤ä¸ºdayæ ·å¼ */
body {
    color: #333;
    background-color: #fff
}
/* dayæ ·å¼ä¸»é¢˜ */
body.day {
    color: #333;
    background: #fff;
}

/* darkæ ·å¼ä¸»é¢˜ */
body.dark {
    color: #eee;
    background: #333;
}
```

```html
<p>
	2022Webå‰ç«¯ä½œä¸šå››ï¼šä¸»é¢˜åˆ‡æ¢
	<button onclick="change('day')" title="äº®è‰²æ¨¡å¼">â˜€ï¸</button>
	<button onclick="change('dark')" title="æš—è‰²æ¨¡å¼">ğŸŒƒ</button>
</p>
```

```js
function change(theme) {
	document.body.className = theme;
}
```

### å…¶ä»–

ä½œä¸šè¿‡ç¨‹ä¸­æˆ‘è¿˜å°è¯•äº†[CSSå˜é‡+ç±»ååˆ‡æ¢](https://segmentfault.com/a/1190000041195585)ã€[SCSS + mixin + ç±»ååˆ‡æ¢](https://zhuanlan.zhihu.com/p/79381867)ã€PostCSSä¸‰ç±»æ–¹æ³•ï¼Œä½†å› ä¸ºç¤ºä¾‹å¤šä»¥Vueæ¡†æ¶ä¸ºä¸»ï¼Œæœ€ç»ˆæˆ‘æ²¡èƒ½æˆåŠŸï¼Œä½†å‘ç°äº†ä¸¤ç¯‡å†™çš„å¾ˆå¥½çš„åšå®¢ã€‚

æ­¤å¤–æˆ‘ä¹Ÿå‘ç°å›´ç»•ä¸»é¢˜åˆ‡æ¢å·²ç»æœ‰ä¸€äº›ä¼˜ç§€çš„å¼€æºæ’ä»¶ï¼Œå¦‚[DarkReader](https://darkreader.org/)ï¼Œ[Darkmode.js](https://github.com/sandoche/Darkmode.js)ï¼Œå®ƒä»¬åˆ©ç”¨åè½¬é¡µé¢é¢œè‰²æ¥åˆ‡æ¢ä¸»é¢˜ã€‚ä¹Ÿæœ‰å¤§ä½¬åœ¨æ­¤åŸºç¡€ä¸Šæ”¹è¿›ï¼Œå¼€å‘äº†[é¡ºæ»‘](https://github.com/guangzan/tinytab)çš„ä½œå“ã€‚è¿™äº›æ–¹æ¡ˆå’Œé¡¹ç›®éƒ½å€¼å¾—æˆ‘å­¦ä¹ ã€‚

## è¿­ä»£4 ç™»å½•æ³¨å†Œ

### å®ç°æ–¹æ¡ˆ 

#### åŸºæœ¬æ¡†æ¶

å‰ç«¯ï¼š

1. ä½¿ç”¨jQueryå®ç°Ajaxï¼Œæ–¹ä¾¿é€šä¿¡ã€‚
2. ä½¿ç”¨md5åŠ å¯†å¯†ç ã€‚

åç«¯ï¼š

1. ä½¿ç”¨node.jsçš„expressè¿›è¡Œè·¯ç”±ã€‚
2. ä½¿ç”¨svg-captchaåº“ç”ŸæˆéªŒè¯ç ã€‚
3. ä½¿ç”¨æœ¬åœ°mysqlæ•°æ®åº“å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€‚

#### å¯†ç å¼ºåº¦

ä½¿ç”¨[æµ…è°ˆå¯†ç å¼ºåº¦è§„åˆ™çš„5ä¸ªç‰ˆæœ¬](https://www.woshipm.com/pd/595757.html)ä¸­çš„å¸¸è§„ç‰ˆå¯†ç å¼ºåº¦è§„åˆ™ï¼š**è‡³å°‘8ä¸ªå­—ç¬¦ï¼Œè‡³å°‘1ä¸ªå­—æ¯ï¼Œ1ä¸ªæ•°å­—å’Œ1ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œ**åŠ åˆ†åˆ¤æ–­ä¾æ®å’Œè§„åˆ™å¦‚ä¸‹ï¼Œå®ç°åœ¨register.htmlä¸­çš„`function cal_psd_score(string)`ï¼Œåˆ©ç”¨ä»¥ä¸‹æ–¹æ³•ååˆ†æ–¹ä¾¿`string.match(/[a-z]/g).length`ï¼š

- \>50: å¼º
- 25-50: ä¸­
- 0- 25: å¼±

ä¸€ã€å¯†ç é•¿åº¦:

- 0åˆ†ï¼šå°äºç­‰äº8ä¸ªå­—ç¬¦

- 10åˆ†: å¤§äº8ä¸ªå­—ç¬¦

äºŒã€å­—æ¯:

- 0 åˆ†: æ²¡æœ‰å­—æ¯
- 10 åˆ†: å…¨éƒ½æ˜¯å°ï¼ˆå¤§ï¼‰å†™å­—æ¯
- 20 åˆ†: å¤§å°å†™æ··åˆå­—æ¯

ä¸‰ã€æ•°å­—:

- 0åˆ†: æ²¡æœ‰æ•°å­—
- 10åˆ†: 1 ä¸ªæ•°å­—
- 20åˆ†: å¤§äºç­‰äº 3ä¸ªæ•°å­—

å››ã€ç¬¦å·:

- 0åˆ†: æ²¡æœ‰ç¬¦å·
- 10åˆ†: 1ä¸ªç¬¦å·
- 25åˆ†: å¤§äº1ä¸ªç¬¦å·

![img](https://docimg8.docs.qq.com/image/AgAABnOijIlr3eMjz-tKb53-p5dudW2-.png?w=271&h=107)

jså®ç°æ—¶å…ˆé€šè¿‡idè·å–å¯¹è±¡ï¼Œç„¶ååˆ©ç”¨`onkeyup`äº‹ä»¶å®æ—¶å¯è§†åŒ–å¯†ç å¼ºåº¦ï¼Œç”¨æˆ·å‹å¥½ã€‚

æ­¤å¤–ï¼Œ**ç¡®è®¤å¯†ç æ¡†åˆå§‹ä¸ºdisabled**ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼`right_psd`å¯ä»¥å®æ—¶ç›‘æ§å¯†ç æ­£ç¡®æ€§ï¼Œ**å½“ä¸”ä»…å½“å¯†ç ç¬¦åˆè§„åˆ™æ—¶ç¡®è®¤å¯†ç æ¡†æ‰å¯è¾“å…¥**ï¼Œç”¨æˆ·å‹å¥½ã€‚

```html
<input type="password" name="password" id="register-password" placeholder="8å­—ç¬¦ä»¥ä¸Šï¼Œå­—æ¯/æ•°å­—/ç‰¹æ®Šå­—ç¬¦è‡³å°‘å„1ä¸ª"><br>
<div class="strong">
	<p class="fl">
		<span class="hover">å¼±</span>
		<span class="">ä¸­</span>
   		<span class="">å¼º</span>
	</p>
</div>
<div>ç¡®è®¤å¯†ç ï¼š</div>
	<input type="password" name="repassword" id="register-repassword" placeholder="å½“ä¸”ä»…å½“ä¸Šä¸€è¡Œå¯†ç ç¬¦åˆè§„åˆ™æ—¶å¯è¾“å…¥" disabled=""><br>
```

```js
window.onload = function () {
    var psd = document.getElementById("register-password");
    var repsd = document.getElementById("register-repassword");
   var fl = document.getElementsByClassName("fl")[0];

   let right_psd = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[$@$!%*#?&])[A-Za-z\d$@$!%*#?&]{8,}$/
   //å®æ—¶ç›‘æ§å¯†ç å¼ºåº¦å’Œæ­£ç¡®æ€§
   psd.onkeyup = function () {
       if (right_psd.test(this.value)) {
            repsd.removeAttribute("disabled");
       	} else {
          	repsd.setAttribute("disabled", "disabled");
    	}
        var score = cal_psd_score(this.value)
 		if (score <= 25) {
			fl.className = "";//"å¼±"
       	} else if (score <= 50) {
            fl.className = "active";//"ä¸­"
       	} else {
          	fl.className = "active1";//"å¼º"
       	}
    }
}
```

#### æ³¨å†Œè§„åˆ™

- å„é¡¹å†…å®¹ä¸å¾—ä¸ºç©º

- ä¸¤æ¬¡è¾“å…¥çš„å¯†ç éœ€ä¸€è‡´

- ç”¨æˆ·åéœ€è¦ç¬¦åˆæ ¼å¼ï¼Œä¸”ä¸å¾—ä¸æ³¨å†Œè¿‡çš„é‡å¤

- é‚®ç®±éœ€è¦ç¬¦åˆæ ¼å¼ï¼Œä¸”ä¸å¾—ä¸æ³¨å†Œè¿‡çš„é‡å¤

- |        | æ­£åˆ™è¡¨è¾¾å¼                                                   | è§„åˆ™                                   |
  | ------ | ------------------------------------------------------------ | -------------------------------------- |
  | ç”¨æˆ·å | ^[\u4e00-\u9fa5a-zA-Z0-9]{3,12}$                             | 3-12å­—ç¬¦ï¼Œä¸­æ–‡/å¤§å°å†™è‹±æ–‡/æ•°å­—å‡å¯     |
  | é‚®ç®±   | ^([a-zA-Z0-9]+[_\|\_\|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_\|\_\|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$ | è‹±æ–‡ã€æ•°å­—ã€ä¸‹åˆ’çº¿ç­‰ï¼ŒåŸŸåä¸ºcomæˆ–cn    |
  | å¯†ç    | ^(?=.*[A-Za-z])(?=.*\d)(?=.*[$@$!%*#?&])[A-Za-z\d$@$!%*#?&]{8,}$ | 8å­—ç¬¦ä»¥ä¸Šï¼Œå­—æ¯/æ•°å­—/ç‰¹æ®Šå­—ç¬¦è‡³å°‘å„1ä¸ª |

ä»¥ä¸Šå†…å®¹ä¸ç¬¦åˆå‡åˆ©ç”¨`alert`æŠ¥é”™æç¤ºç”¨æˆ·ï¼Œå¹¶ç”¨formçš„onsubmitå±æ€§é™åˆ¶actionå±æ€§çš„è·³è½¬ã€‚

#### éªŒè¯ç å®ç°

å€ŸåŠ©`svg-captcha`åº“ç”ŸæˆéªŒè¯ç ï¼Œç„¶ååˆ©ç”¨sessionå­˜æ”¾éªŒè¯ç ï¼Œåœ¨æ¯”å¯¹æ—¶åˆ©ç”¨å°å†™å­—æ¯ï¼Œæ‰€ä»¥ç”¨æˆ·è¾“å…¥çš„éªŒè¯ç ä¸é™åˆ¶å¤§å°å†™ã€‚

```js
const svgCaptcha = require('svg-captcha')
```

```js
app.post('/get_captcha', function (req, res) {
    const codeConfig = {
        size: 4, // éªŒè¯ç é•¿åº¦
        ignoreChars: '0oO1ilI', // éªŒè¯ç å­—ç¬¦ä¸­æ’é™¤ 0oO1ilI
        noise: 2, // å¹²æ‰°çº¿æ¡çš„æ•°é‡
        width: 160,
        height: 50,
        fontSize: 50,
        color: true, // éªŒè¯ç çš„å­—ç¬¦æ˜¯å¦æœ‰é¢œè‰²ï¼Œé»˜è®¤æ²¡æœ‰ï¼Œå¦‚æœè®¾å®šäº†èƒŒæ™¯ï¼Œåˆ™é»˜è®¤æœ‰
        background: "#eee",//èƒŒæ™¯è‰²
    };
    const captcha = svgCaptcha.create(codeConfig);
    req.session.captcha = captcha.text.toLowerCase(); // å°†æ­£ç¡®éªŒè¯ç å­˜åœ¨sessionä¸­
    console.log("éªŒè¯ç ï¼š" + req.session.captcha)
    res.send({ success: true, data: { src: captcha.data, ans: req.session.captcha } });
})
```

å› ä¸º`/get_captcha`è¿”å›çš„æ˜¯`<svg\>\</svg>`è¯­å¥ï¼Œæ‰€ä»¥ç›´æ¥æ¸²æŸ“åˆ°divä¸­ã€‚divç»‘å®š`refresh_captcha()`å‡½æ•°ï¼Œçœ‹ä¸æ¸…å›¾ç‰‡æ—¶å¯ä»¥ç›´æ¥å•å‡»åˆ‡æ¢ã€‚

```html
<div id="img" onclick="refresh_captcha()"></div>
```

```js
document.getElementById("img").innerHTML = data.data.src
```

#### å¯†ç åŠ å¯†

å‰ç«¯åˆ©ç”¨`md5`åŠ å¯†ç”¨æˆ·è¾“å…¥çš„å¯†ç ï¼Œç„¶åå‘é€ç»™åç«¯ã€‚

```javascript
<script src="https://unpkg.com/md5js@1.0.7/dist/md5.js"></script>
function get_encrypt_password(data) {
	return md5.md5(data, 32);
}
```

åç«¯ç”¨åŠ å¯†åçš„å¯†ç ä½œä¸ºåŸå§‹å¯†ç ï¼Œæ·»åŠ **éšæœºæ•°*æ—¥æœŸ**ç”Ÿæˆçš„ç›å€¼ï¼Œæ³¨å†Œæ—¶ä½¿ç”¨`bcryptjsåº“`åŠ å¯†åå­˜å…¥æ•°æ®åº“ï¼Œå¹¶è¿›è¡Œç™»å½•æ—¶çš„æ£€éªŒã€‚

```javascript
//app.post('/register', function (req, res) 
const SALT_FACTOR = 10;
const salt = String(Math.random() * new Date().getTime())
    const password = bcryptjs.hashSync(salt + req.query.encryptPassword, bcryptjs.genSaltSync(SALT_FACTOR));
```

```javascript
//app.post('/login', function (req, res)
if (!bcryptjs.compareSync(user.salt + req.query.password, user.password)) {
	res.send({ success: false, message: 'å¯†ç é”™è¯¯ï¼' })
	return
}
```

#### é‰´æƒæ–¹æ¡ˆ

ä½¿ç”¨sessioné‰´æƒï¼šåˆ©ç”¨**express-session**ä¸­é—´ä»¶ã€‚å®¢æˆ·ç«¯è‹¥åœ¨æœªç™»å½•çš„çŠ¶æ€ä¸‹è¯·æ±‚ä¸»é¡µï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°†è¯¥è¯·æ±‚é‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼›å®¢æˆ·ç«¯åœ¨ç™»å½•åï¼ŒæœåŠ¡å™¨éœ€è¦è®°å½•ä¿å­˜è¯¥å®¢æˆ·ç«¯çš„ç™»å½•çŠ¶æ€ï¼Œå¹¶ç»™äºˆä¸€ä¸ªæ´»åŠ¨æœŸé™ï¼Œè¿™æ ·ä¸‹ä¸€æ¬¡æœåŠ¡å™¨è¯·æ±‚ä¸»é¡µçš„æ—¶å€™ï¼Œå°±èƒ½å¤Ÿåˆ¤æ–­è¯¥å®¢æˆ·ç«¯çš„ç™»å½•çŠ¶æ€ï¼Œè‹¥ç™»å½•çŠ¶æ€æœ‰æ•ˆï¼Œç›´æ¥è¿”å›å®¢æˆ·ç«¯éœ€è¦çš„é¡µé¢ï¼Œå¦åˆ™é‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚

å¯¹äº Session çš„è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½® Session çš„è¿‡æœŸæ—¶é—´ï¼ŒæœåŠ¡å™¨ä¼šæ ¹æ®è‡ªå·±é…ç½®ä¸­é»˜è®¤æœ‰æ•ˆæœŸï¼Œå°†é•¿æœŸä¸ä¸æœåŠ¡å™¨äº¤äº’çš„ Session è¿›è¡Œåˆ é™¤ã€‚

```js
var express = require('express');
var app = express();
var session = require('express-session');
var bodyparser = require('body-parser');

// ä¸‹é¢ä¸‰è¡Œè®¾ç½®æ¸²æŸ“çš„å¼•æ“æ¨¡æ¿
app.set('views', __dirname); //è®¾ç½®æ¨¡æ¿çš„ç›®å½•
app.set('view engine', 'html'); // è®¾ç½®è§£ææ¨¡æ¿æ–‡ä»¶ç±»å‹ï¼šè¿™é‡Œä¸ºhtmlæ–‡ä»¶
app.engine('html', require('ejs').__express); // ä½¿ç”¨ejså¼•æ“è§£æhtmlæ–‡ä»¶ä¸­ejsè¯­æ³•

app.use(bodyparser.json()); // ä½¿ç”¨bodyparderä¸­é—´ä»¶ï¼Œ
app.use(bodyparser.urlencoded({ extended: true }));

// ä½¿ç”¨ session ä¸­é—´ä»¶
app.use(session({
    secret :  'secret', // å¯¹session id ç›¸å…³çš„cookie è¿›è¡Œç­¾å
    resave : true,
    saveUninitialized: false, // æ˜¯å¦ä¿å­˜æœªåˆå§‹åŒ–çš„ä¼šè¯
    cookie : {
        maxAge : 1000 * 60 * 3, // è®¾ç½® session çš„æœ‰æ•ˆæ—¶é—´ï¼Œå•ä½æ¯«ç§’
    },
}));

// è·å–ç™»å½•é¡µé¢
app.get('/login', function(req, res){
    res.sendFile(__dirname + '/login.html')
});

// ç”¨æˆ·ç™»å½•
app.post('/login', function(req, res){
    if(req.body.username == 'admin' && req.body.pwd == 'admin123'){
        req.session.userName = req.body.username; // ç™»å½•æˆåŠŸï¼Œè®¾ç½® session
        res.redirect('/');
    }
    else{
        res.json({ret_code : 1, ret_msg : 'è´¦å·æˆ–å¯†ç é”™è¯¯'});// è‹¥ç™»å½•å¤±è´¥ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢
    }
});

// è·å–ä¸»é¡µ
app.get('/', function (req, res) {
    if(req.session.userName){  //åˆ¤æ–­session çŠ¶æ€ï¼Œå¦‚æœæœ‰æ•ˆï¼Œåˆ™è¿”å›ä¸»é¡µï¼Œå¦åˆ™è½¬åˆ°ç™»å½•é¡µé¢
        res.render('home',{username : req.session.userName});
    }else{
        res.redirect('login');
    }
})

// é€€å‡º
app.get('/logout', function (req, res) {
    req.session.userName = null; // åˆ é™¤session
    res.redirect('login');
});

app.listen(8000,function () {
    console.log('http://127.0.0.1:8000')
})
```

### å®‰è£…ä¸è¿è¡Œè¿‡ç¨‹ï¼ˆå«ç•Œé¢æˆªå›¾ï¼‰

#### è¿æ¥æœ¬åœ°æ•°æ®åº“

ç™»å½•æœ¬åœ°çš„MySQLï¼Œé€‰æ‹©ä¸€ä¸ªdatabaseåˆ›å»ºtable userï¼Œsqlå†…å®¹å¦‚ä¸‹ï¼š

```sql
-- ----------------------------
-- Table structure for user
-- ----------------------------
DROP TABLE IF EXISTS `user`;
CREATE TABLE `user`(
    `id` int(11) NOT NULL AUTO_INCREMENT,
    `username` varchar(255)  NOT NULL,
    `password` varchar(255)  NOT NULL,
    `email` varchar(255)  NOT NULL,
    `salt`  varchar(255)  NOT NULL,
    PRIMARY KEY (`id`)
)ENGINE = InnoDB  CHARACTER SET = utf8mb4;
```

ç„¶åå°†server.jsä¸­çš„user/password/databaseæ”¹æˆè‡ªå·±çš„ä¿¡æ¯ã€‚

```javascript
// è¿æ¥æ•°æ®åº“
const connection = mysql.createConnection({
    host: 'localhost',
    user: 'root',//TODOï¼šæ”¹æˆè‡ªå·±çš„
    password: 'lyx20020305',//TODOï¼šæ”¹æˆè‡ªå·±çš„
    database: 'node_server'//TODOï¼šæ”¹æˆè‡ªå·±çš„
});
connection.connect();
```

#### å¯åŠ¨server.js

åœ¨é¡¹ç›®ç»ˆç«¯è¾“å…¥`node server.js`ï¼Œå‘½ä»¤è¡Œæ˜¾ç¤ºè¿è¡Œåœ¨3001ç«¯å£å³æˆåŠŸï¼ˆè‹¥ç«¯å£è¢«å ç”¨æ”¹æˆç©ºé—²ç«¯å£å³å¯ï¼‰

![img](https://docimg2.docs.qq.com/image/AgAABnOijIkxZ4jRNBtJlKpbvnAGPMBH.png?w=1652&h=1178)

#### ç™»å½•æ³¨å†Œæµç¨‹

åœ¨æœªç™»å½•çŠ¶æ€ä¸‹æ‰“å¼€ä¸€çº§é¡µé¢index.htmlï¼Œä¼šè¢«ç¦æ­¢è®¿é—®ï¼Œè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢login.htmlï¼š![img](https://docimg10.docs.qq.com/image/AgAABnOijIlwJ2mYW15M5bRalJw5W7DI.png?w=1391&h=638)

åˆæ¬¡è¿›å…¥ç™»å½•é¡µé¢æ²¡æœ‰è´¦å·ï¼Œç‚¹å‡»ç«‹å³æ³¨å†Œæˆ–tabæ ä¸­çš„â€œæ³¨å†Œâ€å‰å¾€æ³¨å†Œé¡µé¢register.htmlï¼š![img](https://docimg3.docs.qq.com/image/AgAABnOijIln_4nJLDNNHJedEO5ZlC1V.png?w=1119&h=671)

![img](https://docimg5.docs.qq.com/image/AgAABnOijIk4M0o9VTRCZb1fKEc2AUgY.png?w=1095&h=794)

æŒ‰ç…§æç¤ºå’ŒæŠ¥é”™æ­£ç¡®æ³¨å†Œåï¼Œä¼šè·³è½¬è‡³ç™»å½•é¡µé¢ï¼š![img](https://docimg6.docs.qq.com/image/AgAABnOijIl_OB7oHq9H2r759W4W-qW4.png?w=1163&h=860)

è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·å/é‚®ç®±ã€å¯†ç å’ŒéªŒè¯ç åå³å¯ç™»å½•ï¼Œç”¨æˆ·åå’Œé‚®ç®±å‡æ”¯æŒéªŒè¯ï¼Œå…¶ä¸­å•å‡»éªŒè¯ç ä¼šåˆ‡æ¢å›¾ç‰‡ï¼š![img](https://docimg4.docs.qq.com/image/AgAABnOijImEVLfXEWRF5pFcv5VW7ddI.png?w=1135&h=715)

è‡ªåŠ¨è·³è½¬è‡³é¦–é¡µï¼Œé€šè¿‡sessionè·å¾—ç”¨æˆ·ä¿¡æ¯åå³å¯è®¿é—®ä¸€äºŒçº§é¡µé¢ï¼Œæ˜¾ç¤ºç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œä¸‹å›¾ä¸ºä¸€çº§é¡µé¢ï¼š![img](https://docimg4.docs.qq.com/image/AgAABnOijIm_5XJ7Fr1F36Sph0Qy4dhs.png?w=2142&h=778)

ä¸‹å›¾ä¸ºäºŒçº§é¡µé¢ï¼š

![img](https://docimg4.docs.qq.com/image/AgAABnOijIncTzS3uHlFrZbc9tGQykjs.png?w=2169&h=355)

![img](https://docimg7.docs.qq.com/image/AgAABnOijInaw3OV3BxEfLXFoLIMeS91.png?w=2179&h=898)

ç»è¿‡è‹¥å¹²æ¬¡ç™»å½•æ³¨å†Œçš„æ•°æ®åº“å†…å®¹å¦‚ä¸‹å›¾ï¼š![img](https://docimg3.docs.qq.com/image/AgAABnOijImQzjuLwKhK-aYHAqNaA9Eq.png?w=2517&h=755)

ä»¥ä¸Šåˆ™ä¸ºåˆ©ç”¨é‚®ç®±æ³¨å†Œ/ç™»å½•å®Œæˆçš„æ•´ä½“æµç¨‹ï¼Œä»æœ‰è®¸å¤šç»†èŠ‚å¾…è¡¥å……ï¼šæ³¨å†Œæ—¶çš„é‚®ç®±éªŒè¯ï¼Œå¿˜è®°å’Œä¿®æ”¹å¯†ç æ—¶åˆ©ç”¨é‚®ç®±éªŒè¯ï¼Œé‰´æƒçš„ä¼˜åŒ–ç­‰ï¼Œè®¡åˆ’åœ¨å‰ç«¯æ™ºèƒ½ä¸­å­¦ä¹ å®è·µã€‚

## è¿­ä»£5 å›¾åƒé£æ ¼è¿ç§»

### **å®‰è£…è¿è¡Œè¿‡ç¨‹ä¸å‘ˆç°æ•ˆæœ**

1. å°†codeæ–‡ä»¶å¤¹è§£å‹åˆ°æœ¬åœ°ï¼Œåœ¨`terminal`ä¸­è¾“å…¥`yarn install`å³å¯è¿è¡Œ`server.js`å’Œ`main.js`<img src="https://docimg9.docs.qq.com/image/AgAABnOijIkL4y7dsgFNn5SiymTNtjxZ.png?w=1058&h=503" alt="img" style="zoom:50%;" />
2. è¾“å‡ºå¦‚ä¸Šå›¾åè¿è¡Œ`pic_process.html`ï¼Œè¿›å…¥â€œå›¾åƒé£æ ¼è¿ç§»â€æ ã€‚ï¼ˆæˆ–è¿è¡Œä»»æ„htmlæ–‡ä»¶ï¼Œé€šè¿‡å¯¼èˆªæ è¿›å…¥ï¼Œæ— éœ€ç™»å½•ï¼Œä¸ºäº†æ–¹ä¾¿æµè§ˆä¸€äºŒçº§ç•Œé¢å·²æ³¨é‡Šsessioné‰´æƒç›¸å…³ä»£ç ï¼‰<img src="https://docimg3.docs.qq.com/image/AgAABnOijInMK1ReI4tAxoo0UkrrejQz.png?w=1111&h=251" alt="img" style="zoom:50%;" />
3. ç‚¹å‡»â€œå›¾åƒé£æ ¼è¿ç§»â€ï¼Œå¯ä»¥è¿ç§»ä¸€å¼ å›¾ç‰‡é£æ ¼æˆ–ä¸¤å¼ å›¾ç‰‡é£æ ¼ï¼Œå›¾ç‰‡å¯ä»¥æœ¬åœ°ä¸Šä¼ ï¼Œé£æ ¼å›¾ç‰‡å¯ä»¥éšæœºç”Ÿæˆã€‚<img src="https://docimg5.docs.qq.com/image/AgAABnOijIlwm8BkDwFHpoVhODlbt-KQ.png?w=616&h=942" alt="img" style="zoom:50%;" /><img src="https://docimg5.docs.qq.com/image/AgAABnOijIkFzFRJHCBLNqM2QRKOInMK.png?w=603&h=938" alt="img" style="zoom:50%;" />
4. ç‚¹å‡»â€œå›¾åƒæ»¤é•œæ·»åŠ â€ï¼Œå¯ä»¥ç»™ä¸Šä¼ çš„å›¾ç‰‡æ·»åŠ 15ç§æ»¤é•œã€‚<img src="https://docimg6.docs.qq.com/image/AgAABnOijIm4N1EtNjdP_a0ztN0IClCg.png?w=610&h=891" alt="img" style="zoom: 80%;" />
5. ç‚¹å‡»â€œå…·ä½“å‚æ•°è°ƒæ•´â€ï¼Œå¯ä»¥ç»™ä¸Šä¼ çš„å›¾ç‰‡è®¾ç½®ä¸åŒå‚æ•°çš„å…·ä½“å€¼ï¼Œå¹¶æ·»åŠ å¸¸è§çš„18ç§æ»¤é•œã€‚![img](https://docimg9.docs.qq.com/image/AgAABnOijIn4r79QOwZN5oaSZ2tut3ml.png?w=611&h=1019)
6. ç‚¹å‡»å¯¼èˆªæ çš„â€œå›¾åƒå¡é€šåŒ–â€ä¼šè·³è½¬è‡³ç”¨`cartoonize.py`éƒ¨ç½²çš„`streamlit`é¡µé¢ï¼Œå¯åˆ©ç”¨â€œé“…ç¬”ç´ æâ€ã€"ç»†èŠ‚å¢å¼º"å’Œâ€œé“…ç¬”è¾¹ç¼˜â€ä¸‰ç§æ–¹æ³•å’Œç›¸åº”å‚æ•°çš„è°ƒæ•´å¾—åˆ°å¡é€šåŒ–å›¾ç‰‡ã€‚![img](https://docimg7.docs.qq.com/image/AgAABnOijIkLZdJ6suNBBKiYn4kangzh.png?w=1925&h=1243)
7. ä»¥ä¸Šä¸ºå››å¤§åŠŸèƒ½çš„ä»‹ç»å’Œæ•ˆæœå›¾ï¼Œå®ç°æ–¹æ¡ˆè§ä¸‹ã€‚å› ä¸ºå¡é€šåŒ–æœªä½¿ç”¨nodejsè¿è¡Œï¼Œæ‰€ä»¥ä¸ç®—åœ¨æˆ‘çš„ä½œä¸šé€‰é¢˜â€œå›¾åƒé£æ ¼è¿ç§»â€ä¸­ã€‚æ»¤é•œå’Œå‚æ•°è°ƒæ•´æ˜¯å› ä¸ºè¿ç§»åŸºæœ¬ä½¿ç”¨äº†åˆ«äººé€ å¥½çš„è½®å­ï¼Œæƒ³è¿›è¡Œä¸€äº›è‡ªå·±çš„å®è·µçš„åŠŸèƒ½ï¼Œæ‰€ä»¥åŸåˆ™ä¸Šä¹Ÿä¸ç®—åœ¨â€œå›¾åƒé£æ ¼è¿ç§»â€ä¸­ã€‚

### å®ç°æ–¹æ¡ˆ

#### 1. å›¾åƒé£æ ¼è¿ç§»

åˆ©ç”¨åº“[arbitrary-image-stylization-tfjs](https://github.com/reiinakano/arbitrary-image-stylization-tfjs)å®ç°ï¼Œæºä»£ç åŸºäº`TensorFlow.js`ã€‚

æœ¬åœ°å‘ç°åœ¨startä¸­ç”¨&æ— æ³•è®©`server.js`å’Œ`main.js`åŒæ—¶è¿è¡Œï¼Œæ‰€ä»¥ä½¿ç”¨`npm-run-all -p`è¿è¡Œä¸¤ä¸ªå¸¦ç›‘å¬çš„å‘½ä»¤ï¼ŒæˆåŠŸã€‚

```json
//package.json
"scripts": {
    "start": "npm-run-all -p server main",
	"server": "node server.js",
	"main": "budo main.js:dist/bundle.js --live --host localhost",
}
```

#### 2. å›¾åƒæ»¤é•œæ·»åŠ 

åˆ©ç”¨åº“[lena.js](https://github.com/davidsonfellipe/lena.js)å®ç°ï¼Œåˆ©ç”¨`npm install lena.js --save`å³å¯å®‰è£…å¹¶ä½¿ç”¨ã€‚

åˆ©ç”¨`LenaJS.filterImage`æ–¹æ³•å³å¯å°†`filter`ä½œç”¨äº`originalImage`ï¼Œè¾“å‡ºåœ¨`filteredImageCanvas`ä¸Šã€‚

```js
//lena_js.html
var imageLoader = document.getElementById('imageLoader');
var originalImage = document.getElementById("original-image");
var filteredImageCanvas = document.getElementById("filtered-image");
var filterChanger = document.getElementById("filter-changer");
var imageUploaded = false;

// Handle image upload into img tag
imageLoader.addEventListener('change', function(e){
		var reader = new FileReader();
    
    reader.onload = function(event){
        originalImage.onload = function(){
             console.log("Image Succesfully Loaded");
             imageUploaded = true;
        };
        originalImage.src = event.target.result;
    };
    
    reader.readAsDataURL(e.target.files[0]);   
}, false);

filterChanger.addEventListener("change", function(e){
	var filter = filterChanger.value;
  	
  if(imageUploaded && filter != "none"){
  
  	// Apply filter
  	LenaJS.filterImage(filteredImageCanvas, LenaJS[filter], originalImage);
  }
}, false);
```

#### 3. å…·ä½“å‚æ•°è°ƒæ•´

åˆ©ç”¨åº“[CamanJS](https://github.com/meltingice/CamanJS/)å®ç°ï¼Œåˆ©ç”¨`npm install caman`å³å¯å®‰è£…å¹¶ä½¿ç”¨ã€‚

åˆå§‹demoå¯å®ç°é™æ€å›¾ç‰‡çš„å¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä¿®æ”¹äº†$(document).readyå‡½æ•°ä»¥å…è®¸ç”¨æˆ·æœ¬åœ°ä¸Šä¼ å›¾ç‰‡ã€‚åŸç†æ˜¯ç›‘å¬ä¸Šä¼ æœ¬åœ°å›¾ç‰‡çš„`input type="file"`ï¼Œè‹¥åŠ è½½äº†æ–°çš„`img`ï¼Œåˆ™æ›´æ–°Camanå¯¹è±¡cå’Œiã€‚æ›´æ–°æ–¹æ³•æ˜¯åˆ©ç”¨å‡½æ•°`Caman.replaceCanvas()`ï¼Œæ‰€ä»¥æˆ‘æ·»åŠ äº†è¾…åŠ©å‡½æ•°`convertImageToCanvas()`ï¼Œå°†ä¸Šä¼ çš„æ–°å›¾ç‰‡è½¬æˆ`newCanvas`ã€‚

é—æ†¾çš„æ˜¯ï¼Œæœ€ç»ˆè™½å®ç°åŠŸèƒ½ï¼Œä½†ç½‘é¡µæ˜¾ç¤ºå’Œè°ƒæ•´çš„å›¾ç‰‡å‡ä¸ºä¸Šä¸€å¼ ä¸Šä¼ çš„å›¾ç‰‡ï¼Œæ‰€ä»¥ç”¨æˆ·åœ¨ä¸Šä¼ æƒ³å¤„ç†çš„å›¾ç‰‡åï¼Œéšä¾¿å†ä¸Šä¼ ä¸€å¼ ä¸é‡å¤çš„å›¾ç‰‡å³å¯ä½¿ç”¨ã€‚è¿™ä¸ªbugå¤§æ¦‚ç‡ä¸æºç æœ‰å…³ï¼Œä½†å› ä¸ºéš¾ç†è§£æœªèƒ½è§£å†³:(

```js
//static/js/caman.js
function convertImageToCanvas(image) {
	// åˆ›å»ºcanvas DOMå…ƒç´ ï¼Œå¹¶è®¾ç½®å…¶å®½é«˜å’Œå›¾ç‰‡ä¸€æ ·
	var canvas = document.createElement("canvas");
	canvas.width = image.width;
	canvas.height = image.height;
    // åæ ‡(0,0) è¡¨ç¤ºä»æ­¤å¤„å¼€å§‹ç»˜åˆ¶ï¼Œç›¸å½“äºåç§»ã€‚
    canvas.getContext("2d").drawImage(image, 0, 0);
    return canvas;
}
$(document).ready(function () {
    var imageLoader1 = document.getElementById('imageLoader1');
    var image1 = document.getElementById("example");
    var imageLoader2 = document.getElementById('imageLoader2');
    var image2 = document.getElementById("preset-example");
    c = Caman("#example");
    i = Caman("#preset-example");
    imageLoader1.addEventListener("change", function (e) {
        var reader = new FileReader();
        reader.onload = function (event) {
            image1.onload = function () {
                console.log("Image1 Succesfully Loaded");
            };
            image1.src = event.target.result;
        };
        console.log(e.target.files)
        reader.readAsDataURL(e.target.files[0]);
        var newCanvas = convertImageToCanvas(image1);
        c.replaceCanvas(newCanvas);
    });
    imageLoader2.addEventListener("change", function (e) {
        var reader = new FileReader();
        reader.onload = function (event) {
            image2.onload = function () {
                console.log("Image2 Succesfully Loaded");
            };
            image2.src = event.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
        var newCanvas = convertImageToCanvas(image2);
        i.replaceCanvas(newCanvas);
    });
    c = Caman("#example");
    i = Caman("#preset-example");
    $(".FilterSetting input").each(function () {
        var j;
        j = $(this).data("filter");
        return b[j] = $(this).val()
    });
    $("#Filters").on("change", ".FilterSetting input", function () {
        var j, k;
        j = $(this).data("filter");
        k = $(this).val();
        b[j] = k;
        $(this).find("~ .FilterValue").html(k);
        return a()
    });
    return $("#PresetFilters").on("click", "a", function () {
        return h($(this).data("preset"))
    })
})
```

#### 4. å›¾åƒå¡é€šåŒ–

åˆ©ç”¨åº“`cv2`å®ç°ä¸‰ç§åŠŸèƒ½çš„å¡é€šåŒ–ï¼Œå¹¶ç”¨`streamlit`å¯è§†åŒ–å±•ç¤ºã€‚

```python
def cartoonization(img, cartoon):
    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

    if cartoon == "é“…ç¬”ç´ æ":
        value = st.sidebar.slider('è°ƒæ•´è‰å›¾çš„äº®åº¦ï¼ˆå€¼è¶Šé«˜ï¼Œè‰å›¾è¶Šäº®ï¼‰',
                                  0.0, 300.0, 250.0)
        kernel = st.sidebar.slider(
            'è°ƒæ•´è‰å›¾è¾¹ç¼˜çš„ç²—ä½“ï¼ˆå€¼è¶Šé«˜ï¼Œè¾¹ç¼˜è¶Šç²—ï¼‰', 1, 99, 25,
            step=2)

        gray_blur = cv2.GaussianBlur(gray, (kernel, kernel), 0)

        cartoon = cv2.divide(gray, gray_blur, scale=value)

    if cartoon == "ç»†èŠ‚å¢å¼º":
        smooth = st.sidebar.slider(
            'è°ƒæ•´å›¾åƒçš„å¹³æ»‘åº¦çº§åˆ«ï¼ˆå€¼è¶Šé«˜ï¼Œå›¾åƒè¶Šå¹³æ»‘ï¼‰', 3, 99, 5, step=2)
        kernel = st.sidebar.slider('è°ƒæ•´å›¾åƒçš„æ¸…æ™°åº¦ï¼ˆå€¼è¶Šä½ï¼Œè¶Šæ¸…æ™°ï¼‰', 1, 21, 3,
                                   step=2)
        edge_preserve = st.sidebar.slider(
            'è°ƒæ•´é¢œè‰²å¹³å‡æ•ˆæœï¼ˆä½ï¼šä»…å¹³æ»‘ç›¸ä¼¼çš„é¢œè‰²ï¼Œé«˜ï¼šå¹³æ»‘ä¸åŒçš„é¢œè‰²ï¼‰',
            0.0, 1.0, 0.5)

        gray = cv2.medianBlur(gray, kernel)
        edges = cv2.adaptiveThreshold(gray, 255, cv2.ADAPTIVE_THRESH_MEAN_C,
                                      cv2.THRESH_BINARY, 9, 9)

        color = cv2.detailEnhance(img, sigma_s=smooth, sigma_r=edge_preserve)
        cartoon = cv2.bitwise_and(color, color, mask=edges)

    if cartoon == "é“…ç¬”è¾¹ç¼˜":
        kernel = st.sidebar.slider('è°ƒæ•´è‰å›¾çš„æ¸…æ™°åº¦ï¼ˆå€¼è¶Šä½ï¼Œè¶Šé”åˆ©ï¼‰', 1, 99,
                                   25, step=2)
        laplacian_filter = st.sidebar.slider(
            'è°ƒæ•´è¾¹ç¼˜æ£€æµ‹åŠŸç‡ï¼ˆå€¼è¶Šé«˜ï¼ŒåŠŸèƒ½è¶Šå¼ºå¤§ï¼‰', 3, 9, 3, step=2)
        noise_reduction = st.sidebar.slider(
            'è°ƒæ•´è‰å›¾çš„å™ªç‚¹æ•ˆæœï¼ˆå€¼è¶Šé«˜ï¼Œå™ªå£°è¶Šå¤§ï¼‰', 10, 255, 150)

        gray = cv2.medianBlur(gray, kernel)
        edges = cv2.Laplacian(gray, -1, ksize=laplacian_filter)

        edges_inv = 255 - edges

        dummy, cartoon = cv2.threshold(edges_inv, noise_reduction, 255, cv2.THRESH_BINARY)


    return cartoon

```

æœ¬æƒ³åˆ©ç”¨`PythonShell`åœ¨`server.js`ä¸­è°ƒç”¨pythonè„šæœ¬è¿è¡Œï¼Œä½†æœªè§£å†³ç¬¬ä¸‰æ–¹åº“å¼•å…¥çš„é—®é¢˜ï¼Œæ‰€ä»¥ä½¿ç”¨äº†`streamlit`éƒ¨ç½²ï¼Œå®ƒå¯ä»¥åˆ©ç”¨å®‰è£…`requirements.txt`è§£å†³ä¾èµ–é—®é¢˜ã€‚

[éƒ¨ç½²åœ°å€](https://lyxx2535-streamlit-file-main-jpg2qd.streamlit.app/) [githubé“¾æ¥ï¼ˆå«requirements.txtï¼‰](https://github.com/lyxx2535/streamlit_file)

```js
const { PythonShell } = require("python-shell");
let options = {
    pythonPath: "C:\\Users\\84368\\AppData\\Local\\Programs\\Python\\Python38\\python.exe",
    args: ["-d",encoded],
};
PythonShell.run("cartoonize.py", options, function (err, result) {
    if (err){
        console.log(err)
    }else{
        console.log("execute")
    }
});
```

![img](https://docimg4.docs.qq.com/image/AgAABnOijInUTBspmCVAL5oCmr4-6qnQ.png?w=2560&h=1520)

### æ–‡ä»¶æ ‘ç»“æ„

å› ä¸ºæœ¬æ¬¡ä½œä¸šä½¿ç”¨äº†è¾ƒå¤šçš„å¤–æ¥åº“ï¼Œæ‰€ä»¥æˆ‘è°ƒæ•´äº†æ–‡ä»¶ç»“æ„ï¼Œé‡è¦æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š

- static
  - cssï¼š
    - caman.cssï¼šæ”¯æŒâ€œå…·ä½“å‚æ•°è°ƒæ•´â€ã€‚
  - htmlï¼š
    - caman_js.htmlï¼šâ€œå…·ä½“å‚æ•°è°ƒæ•´â€çš„æºä»£ç ã€‚
    - lena_js.htmlï¼šâ€œå›¾åƒæ»¤é•œæ·»åŠ â€çš„æºä»£ç ã€‚
  - jsï¼š
    - caman.jsï¼šæ”¯æŒâ€œå…·ä½“å‚æ•°è°ƒæ•´â€ã€‚
    - links.jsï¼šæ”¯æŒâ€œå›¾åƒé£æ ¼è¿ç§»â€ã€‚
    - 4ä¸ªsaved_modelå¼€å¤´çš„æ–‡ä»¶å¤¹ï¼šæ”¯æŒâ€œå›¾åƒé£æ ¼è¿ç§»â€ã€‚
  - picsï¼š
    - å«æœ‰æ”¯æŒâ€œå›¾åƒé£æ ¼è¿ç§»â€çš„é»˜è®¤jpgã€‚
- cartoonize.pyï¼šâ€œå›¾åƒå¡é€šåŒ–â€çš„æºä»£ç ã€‚
- home.htmlï¼šç€‘å¸ƒæµå¸ƒå±€çš„é¦–é¡µï¼Œä¸æœ¬æ¬¡ä½œä¸šæ— å…³ã€‚
- index.htmlï¼šâ€œå›¾åƒé£æ ¼è¿ç§»â€çš„æºä»£ç ã€‚
- main.jsï¼šæ”¯æŒâ€œå›¾åƒé£æ ¼è¿ç§»â€ã€‚
- package.jsonï¼šå«`yarn start`å‘½ä»¤çš„å®šä¹‰ã€‚
- pic_process.htmlï¼šâ€œå›¾åƒé£æ ¼è¿ç§»â€åŠŸèƒ½ä½¿ç”¨é¡µé¢ã€‚
- server.jsï¼šæ”¯æŒç™»å½•æ³¨å†Œçš„æ¥å£ï¼Œä¸æœ¬æ¬¡ä½œä¸šæ— å…³ã€‚

### å‚è€ƒçš„æ–‡çŒ®

ä¸€ã€[ã€Šä»€ä¹ˆæ˜¯å›¾åƒé£æ ¼è¿ç§»ã€‹](https://zhuanlan.zhihu.com/p/469685783)

æ€»ç»“ï¼šç ”ç©¶ä»‹ç»ã€æ–¹æ³•æ¼”è¿›ã€‚

é£æ ¼è¿ç§»æŒ‡çš„æ˜¯ä¸¤ä¸ªä¸åŒåŸŸä¸­å›¾åƒçš„è½¬æ¢

1. ä¼ ç»Ÿçš„å›¾åƒé£æ ¼è¿ç§»

   1.1è®¡ç®—æœºå›¾å½¢å­¦é¢†åŸŸå’Œè®¡ç®—æœºè§†è§‰é¢†åŸŸ

   1.2éçœŸå®æ„Ÿå›¾å½¢å­¦

2. åŸºäºç¥ç»ç½‘ç»œçš„å›¾åƒé£æ ¼è¿ç§»

   2.1 åŸºäºåœ¨çº¿å›¾åƒä¼˜åŒ–çš„æ…¢é€Ÿå›¾åƒé£æ ¼åŒ–è¿ç§»ç®—æ³•

   2.2 åŸºäºç¦»çº¿æ¨¡å‹ä¼˜åŒ–çš„å¿«é€Ÿå›¾åƒé£æ ¼åŒ–è¿ç§»ç®—æ³•

   2.3 MSPM çš„å¿«é€Ÿé£æ ¼è½¬ç§»

3. åŸºäºå¯¹æŠ—ç”Ÿæˆç½‘ç»œçš„å›¾åƒè¿ç§»

   3.1 å¯¹æŠ—ç”Ÿæˆç½‘ç»œï¼ˆadversarial generative networkï¼‰

   3.2 CycleGAN

   3.3 StarGAN

äºŒã€[ã€Šé˜¿é‡Œå‰ç«¯æ™ºèƒ½åŒ–æŠ€æœ¯æ¢ç´¢å’Œæœªæ¥æ€è€ƒã€‹](https://juejin.cn/post/7119391755362893861)

åœ¨è¿™ç§è¦æ±‚ä¸‹ï¼Œ**æ•°æ®åˆ†æå’ŒåŸºäºæ•°æ®çš„å»ºæ¨¡èƒ½åŠ›å°†ä¼šè‡³å…³é‡è¦**ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥é€šè¿‡Pipcook-Cloudè¿™ä¸ªé¡¹ç›®å¢å¼ºå‰ç«¯æ•°æ®åˆ†æå’Œæ™ºèƒ½åŒ–ç®—æ³•èƒ½åŠ›ï¼Œ**é€æ¸å°†æŠ€æœ¯äº§å‡ºã€ç”¨æˆ·ä½¿ç”¨è¡Œä¸ºæ•°æ®ä»¥åŠä¸šåŠ¡æŒ‡æ ‡ä¸‰è€…å…³è”åœ¨ä¸€èµ·**ã€‚

å¦‚æœè¯´PipCook-Cloudæ‰“é€šäº†å‰ç«¯å’Œä¸šåŠ¡æ•°æ®çš„æ¡¥æ¢ï¼Œé€šè¿‡å¹³å°åŒ–äº§å“åŒ–çš„æ–¹å¼æä¾›äº†æ•°æ®åŠ å·¥å’Œæ•°æ®å¼€å‘çš„å·¥ç¨‹èƒ½åŠ›ï¼Œé‚£ä¹ˆDataCookåˆ™æ˜¯åœ¨åº•å±‚ä¾›ç»™PipCookå¹³å°çš„ç‡ƒæ–™ã€‚**DataCook**æä¾›äº†JSç”Ÿæ€ä¸‹é¢å‘å‰ç«¯çš„æ•°æ®ç§‘å­¦å’Œæœºå™¨å­¦ä¹ å·¥å…·åº“ï¼Œå¸®åŠ©å‰ç«¯åŒå­¦è½»æ¾è¿ç”¨åˆ†æå»ºæ¨¡èƒ½åŠ›å‰–æè‡ªå·±çš„ä¸šåŠ¡æ•°æ®ï¼Œäº§å‡ºå…·æœ‰ä»·å€¼çš„åˆ†ææˆæœã€‚

2021å¹´é€‰å®šäº†ä¸¤ä¸ªæ–¹å‘æ¥ä¼˜åŒ–æˆ‘ä»¬çš„ç«¯ä¸Šå¼•æ“ï¼šWASM+Rust+SIMDå’ŒWebGPUã€‚TensorFlow.jsè™½ç„¶æ²¡æœ‰ä½¿ç”¨Rustï¼Œä½†æ˜¯ä¹Ÿåœ¨ä½¿ç”¨WASM+SIMDã€‚

<mark>å‰ç«¯æ™ºèƒ½åŒ–æŠ€æœ¯åº”ç”¨ç¯‡</mark>

1. ä»£ç æ¨è-sophon 2. è®¾è®¡ç¨¿ç”Ÿæˆä»£ç -imgcook 3. å›¾å±‚è§£æ 4. å¸ƒå±€åˆ†æ 5. ä»£ç ç”Ÿæˆ6. æ™ºèƒ½åŒ–èƒ½åŠ›æå‡ 7. äº§å“ä½“éªŒä¼˜åŒ– 8. Imgcookçš„ä¸šåŠ¡åº”ç”¨ï¼šæ™ºèƒ½UI 9. æœ€ç»ˆå½±å“åŠ©æ‰‹APPæ•ˆç”¨çš„å…³é”®æ˜¯éšç§ä¿æŠ¤å’Œç«¯ä¸Šç®—åŠ›

UIæ™ºèƒ½åŒ–ä¼šæœç€æ²¡æœ‰UIçš„æ–¹å‘æ¼”è¿›ï¼Œåº”ç”¨ä¼šå‘ç€æœåŠ¡åŒ–å’ŒäºŒè¿›åˆ¶è¾“å…¥è¾“å‡ºæ¼”è¿›ï¼Œç§»åŠ¨æ“ä½œç³»ç»Ÿä¼šè¿›åŒ–ä¸ºåªæœ‰ä¸€ä¸ªAPP â€”â€” **ç”¨æˆ·çš„ç§äººæ™ºèƒ½ä½“**ï¼Œå…¶å®ƒAPPè¢«æœåŠ¡åŒ–å¹¶å’Œè¯¥æ™ºèƒ½ä½“è¿›è¡ŒäºŒè¿›åˆ¶äº¤äº’ï¼Œè€Œç”¨æˆ·åˆ™ä¼šå›å½’è‡ªç„¶ã€ç¤¾ä¼šå’Œç”Ÿæ´»ã€‚æœªæ¥ï¼Œå¤§å®¶å¯èƒ½åªä½©æˆ´**çœ¼é•œæˆ–è€³æœº**å°±å¯ä»¥å®Œæˆä»Šå¤©æ‰‹æœºä¸Šçš„å¤§éƒ¨åˆ†åŠŸèƒ½

ä¸‰ã€[ã€ŠåŸºäºOpenCVçš„å›¾åƒå¡é€šåŒ–ã€‹](https://cloud.tencent.com/developer/article/1678909)

è®²è§£äº†å¦‚ä½•ç”¨OpenCVå®ç°å¡é€šåŒ–çš„è‹¥å¹²æ–¹æ³•ï¼Œä»£ç ç®€æ´æ˜“æ‡‚ï¼Œååˆ†å®¹æ˜“è¿è¡Œã€‚

å››ã€[ã€ŠåŸºäºæ·±åº¦å­¦ä¹ çš„å›¾åƒçœŸå®é£æ ¼è¿ç§»ã€‹](https://zhuanlan.zhihu.com/p/28605436)

1. å›¾åƒçœŸå®é£æ ¼è¿ç§»é—®é¢˜ä»‹ç»ï¼šé£æ ¼æ²¡æœ‰ä¸¥æ ¼çš„å®šä¹‰ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜è€¶æ²¡æœ‰ä¸¥æ ¼çš„æ•°å­¦å®šä¹‰ã€‚
2. ç®—æ³•åŸç†åˆ†æï¼šè¯¥é—®é¢˜å¹¶ä¸æ˜¯æœºå™¨å­¦ä¹ é€šå¸¸çš„"è®­ç»ƒ-æµ‹è¯•"æµç¨‹ï¼Œè€Œåªæ˜¯ä¸€ä¸ªæ™®é€šçš„è¿­ä»£æ±‚è§£è¿‡ç¨‹ã€‚è¿­ä»£ç»“æŸï¼Œå°±å¾—åˆ°ç›®æ ‡å›¾åƒã€‚è¿™ä¹Ÿå¯¼è‡´äº†è¯¥ç®—æ³•çš„è¿è¡Œé€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚
3. æå‡æ€§èƒ½ï¼šå³**éœ€è¦åœ¨é£æ ¼è¿ç§»çš„åŒæ—¶ï¼Œæœ€å¤§ç¨‹åº¦ä¿ç•™è¾“å…¥å›¾åƒçš„çœŸå®ç»†èŠ‚**ã€‚
   1. å¯¹äºè¿‡ç¨‹ä¸­çš„ç•¸å˜è¿›è¡Œæƒ©ç½šã€‚
   2. å¯¹è¾“å…¥å›¾åƒè¿›è¡Œè¯­ä¹‰åˆ†å‰²ã€‚

è¿™ä¸ªä½œè€…æä¾›çš„docker imageæœªèƒ½åœ¨æˆ‘çš„æœ¬åœ°æˆåŠŸè¿è¡Œã€‚

